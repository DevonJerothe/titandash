{% extends "base.html" %}
{% load staticfiles %}

{% block content %}
    <div id="accordion">
        <div class="card">
            <div class="card-header" id="allPrestiges">
                <h5 class="mb-0">
                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne">Prestiges</button>
                    <button id="exportPrestigesJson" type="button" class="float-right btn btn-primary">Export JSON<span style="margin-left: 8px;" class="fa fa-file-export"></span></button>
                </h5>
            </div>

            <div id="collapseOne" class="collapse show" data-parent="#accordion">
                <div class="card-body">
                   <div id="allPrestigeContent" style="width: 100%;">
                       <div class="row">
                           <div style="width: 33%;" class="col-sm text-center border-right">
                               <small>Total Prestiges</small><br/>
                               <strong id="allPrestigeAvgStageValue">{{ totalPrestiges }}</strong>
                           </div>
                           <div style="width: 33%;" class="col-sm text-center border-right">
                                <small>Average Duration</small><br/>
                                <strong id="allPrestigeAvgDurationValue">{{ avgPrestigeDuration }}</strong>
                           </div>
                           <div style="width: 33%;" class="col-sm text-center">
                               <small>Average Stage</small><br/>
                               <strong id="allPrestigeAvgStageValue">{{ avgPrestigeStage }}</strong>
                           </div>
                       </div>
                       <hr/>
                       <table id="allPrestigeTable" class="display table table-sm table-borderless table-hover table-striped" style="width: 100%;">
                           <thead>
                               <tr>
                                   <th>Timestamp</th>
                                   <th>Duration</th>
                                   <th>Stage</th>
                                   <th>Artifact</th>
                                   <th>Session</th>
                               </tr>
                           </thead>
                           <tbody>
                                {% for prestige in prestiges %}
                                    <tr>
                                        <td data-order="{{ prestige.timestamp.epoch }}">{{ prestige.timestamp.formatted }}</td>
                                        <td>{{ prestige.duration.formatted }}</td>
                                        <td>{{ prestige.stage|default_if_none:"N/A" }}</td>
                                        <td> <img height="20" width="20" src="{% static prestige.artifact.image %}" alt="{{ prestige.artifact.name }}"> {{ prestige.artifact.title }}</td>
                                        <td><a href="{{ prestige.session.url }}">{{ prestige.session.uuid_short }}</a></td>
                                    </tr>
                                {% endfor %}
                           </tbody>
                       </table>
                   </div>
                </div>
            </div>
        </div>
    </div>
    <div id="jsonData" data-json="{{ PRESTIGES_JSON }}" style="display: none;"></div>
{% endblock %}

{% block extra_js %}
    <script src="{% static "js/allPrestiges.js" %}"></script>
{% endblock %}